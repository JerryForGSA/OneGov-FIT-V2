<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: sans-serif; padding: 20px; }
      
      /* Card Styling */
      .card {
        padding: 20px;
        margin: 10px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        cursor: pointer;
        display: inline-block;
        border-radius: 8px;
        transition: all 0.2s ease;
        width: 200px;
        vertical-align: top;
      }
      .card:hover {
        background-color: #e2e6ea;
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      .card h3 { margin-top: 0; color: #333; }
      
      /* Specific Colors for Types */
      .oem { border-left: 5px solid #007bff; }
      .vendor { border-left: 5px solid #28a745; }
      .report { border-left: 5px solid #ffc107; }
    </style>
  </head>
  <body>

    <h2>Access Logging Test Dashboard</h2>

    <!-- 1. OEM CARD -->
    <div class="card oem" onclick="handleCardClick('https://www.google.com', 'OEM')">
      <h3>OEM View</h3>
      <p>Logs 'OEM' access -> Navigates to Google.</p>
    </div>

    <!-- 2. VENDOR CARD -->
    <div class="card vendor" onclick="handleCardClick('https://www.bing.com', 'Vendor')">
      <h3>Vendor View</h3>
      <p>Logs 'Vendor' access -> Navigates to Bing.</p>
    </div>

    <!-- 3. REPORT GENERATOR (Special Case) -->
    <!-- This calls a specific server function instead of the generic one -->
    <div class="card report" onclick="handleReportClick()">
      <h3>Report Generator</h3>
      <p>Logs 'Report Generator' -> Reloads/Navigates.</p>
    </div>

    <!-- 4. ENTITY CARD (New) -->
    <div class="card" onclick="handleEntityClick('Acme Corp', 'Agency')">
      <h3>Entity: Acme Corp</h3>
      <p>Logs specific entity access without leaving page.</p>
    </div>

    <script>
      /**
       * MAIN NAVIGATOR: Handles standard view clicks (OEM, Agency, Vendor)
       * Logs access FIRST, then navigates.
       */
      function handleCardClick(url, viewType) {
        console.log("⏳ Logging access for:", viewType);

        google.script.run
          .withSuccessHandler(function(response) {
            console.log("✅ Log success:", response);
            window.top.location.href = url; // Navigate AFTER log
          })
          .withFailureHandler(function(error) {
            console.error("❌ Log failed:", error);
            window.top.location.href = url; // Navigate anyway
          })
          .logUserAccess(viewType); // Matches your .gs function
      }

      /**
       * SPECIAL HANDLER: For Report Generator
       * Calls logReportGeneratorAccess() specifically
       */
      function handleReportClick() {
        console.log("⏳ Logging Report Generator access...");

        google.script.run
          .withSuccessHandler(function(response) {
            console.log("✅ Report Log success");
            // Example: Navigate to the report tool URL
            window.top.location.href = 'https://datastudio.google.com'; 
          })
          .withFailureHandler(function(error) {
            console.error("❌ Report Log failed:", error);
            window.top.location.href = 'https://datastudio.google.com';
          })
          .logReportGeneratorAccess(); // Matches your specific .gs helper
      }

      /**
       * ENTITY HANDLER: For clicking specific entity cards
       * Calls logEntityAccess(name, type)
       * Usually doesn't navigate away, just opens a modal
       */
      function handleEntityClick(name, type) {
        console.log(`⏳ Logging entity: ${name} (${type})`);

        google.script.run
          .withSuccessHandler(function(response) {
            console.log("✅ Entity logged:", response);
            alert("Entity Logged! Now opening modal for " + name);
            // Here you would normally run code to open your modal
          })
          .withFailureHandler(function(error) {
            console.error("❌ Entity log failed:", error);
          })
          .logEntityAccess(name, type); // Matches your .gs function
      }
    </script>

  </body>
</html>
